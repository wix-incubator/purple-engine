#!/usr/bin/env node

const _ = require('lodash');
const path = require('path');

const fs = require('fs');

const child_process = require('child_process');

const engineDir = `${__dirname}/..`;
const config = require(path.join(process.cwd(), 'package.json')).purple;

process.chdir(`${__dirname}/../../..`);

const modulesRequires = _.map(config.modules, (m) => `require('${m}').default`).join(', ');
fs.writeFileSync('modules.js', 
`
// This file is auto-generated by purple

export default [${modulesRequires}];
`
);

console.log(`cwd: ${process.cwd()}`);

const rnStartCmd = `react-native start --root "${engineDir}"`;
console.log(`Running in background: ${rnStartCmd}`);
child_process.exec(rnStartCmd);

const rnRunIosCmd = `react-native run-ios --no-packager --project-path "${engineDir}"/ios/`;
console.log(`Running sync: ${rnRunIosCmd}`);
child_process.execSync(rnRunIosCmd);
